<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thrust</title>
    <link rel="stylesheet" href="assets/css/game.css" />
  </head>
  <body>
    <div id="game-container">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <canvas id="map" width="100" height="230"></canvas>
    </div>

    <script type="module">
      import Game from "./assets/js/Game.js";

      // Global constants
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const mapCanvas = document.getElementById("map");
      const mapCtx = mapCanvas.getContext("2d");

      var game = new Game({
        canvas: canvas,
        mapCanvas: mapCanvas
      });

      // Responsive canvas for mobile
      function resizeCanvas() {
        const container = document.getElementById('game-container');
        let w = window.innerWidth;
        let h = window.innerHeight;
        
        // For mobile, we want to use most of the screen
        const padding = 20; // Small padding around the canvas
        w -= padding;
        h -= padding;
        
        // Set canvas size to fill screen
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        
        // Set actual canvas resolution (can be different from display size)
        canvas.width = w;
        canvas.height = h;
        
        // Resize map canvas proportionally
        const mapScale = 0.15; // Map is 15% of main canvas width
        mapCanvas.width = Math.max(80, Math.floor(w * mapScale));
        mapCanvas.height = Math.max(120, Math.floor(h * mapScale));
        mapCanvas.style.width = mapCanvas.width + 'px';
        mapCanvas.style.height = mapCanvas.height + 'px';
        
        console.log(`Canvas resized to: ${w}x${h}`);

        game.resize();
      }

      // Resize on window resize and on load
      window.addEventListener('resize', resizeCanvas);
      window.addEventListener('orientationchange', resizeCanvas);
      resizeCanvas();

      // Game loop
      function gameLoop() {
        game.update();

        game.draw(ctx, mapCtx);
        requestAnimationFrame(gameLoop);
      }

      // Key handlers
      window.addEventListener("keydown", (e) => {
        if (game.gameOver && e.key === " ") {
          game.reset();
          return;
        }

        switch (e.key) {
          case "ArrowLeft":
            game.keys.left = true;
            break;
          case "ArrowRight":
            game.keys.right = true;
            break;
          case "ArrowUp":
            game.keys.up = true;
            break;
          case " ":
            game.keys.space = true;
            break;
        }
      });

      window.addEventListener("keyup", (e) => {
        switch (e.key) {
          case "ArrowLeft":
            game.keys.left = false;
            break;
          case "ArrowRight":
            game.keys.right = false;
            break;
          case "ArrowUp":
            game.keys.up = false;
            break;
          case " ":
            game.keys.space = false;
            break;
        }
      });

      // Start the game
      gameLoop();
    </script>
  </body>
</html>
